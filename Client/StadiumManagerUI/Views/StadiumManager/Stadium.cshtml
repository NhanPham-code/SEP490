
@{
    ViewData["Title"] = "StadiumHome";
}

<h2 class="mb-4">Quản lý Stadium</h2>

<!-- Nút mở modal thêm -->
<button class="btn btn-primary mb-3" onclick="openCreate()">+ Thêm Stadium</button>
<div id="stadium-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>

@section Scripts{
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="js/app.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            displayList("&$filter=CreatedBy eq 1");
        });


                function displayList(searchTerm){
            var searchUrl = searchTerm + `&$top=${top}&$skip=${skip}`;
            console.log(searchUrl);

                                                           $.ajax({
            url: '/StadiumManager/GetAllAndSearch', // Endpoint for POST request
            type: 'POST',
            data: {searchTerm: searchUrl},
            success: function (data) {
                let count = data["@@odata.count"];
                sessionStorage.setItem('stadiumCount', count); // Lưu số lượng sân vào sessionStorage
                console.log(skip);
                let html = '';
                if (data.value && data.value.length > 0) {
                    data.value.forEach(function (item) {
                        let imageUrl = item.StadiumImages.length > 0 ? item.StadiumImages[0].ImageUrl : 'default.jpg';
                        let price = item.Courts.length > 0 ? item.Courts[0].PricePerHour : 0;
                        // Removed console.log(item.val) as 'val' is not defined in the data structure
                        console.log(item);

                        // Format tiền Việt Nam
                        let formattedPrice = new Intl.NumberFormat('vi-VN', {
                            style: 'currency',
                            currency: 'VND'
                        }).format(price);
                        let address = item.Address ?? '';

                        html += `<div class="card-content bg-white rounded-2xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow duration-300">
                            <div class="relative h-48">
                                <img src="https://localhost:7280/${imageUrl}" alt="Stadium" class="w-full h-full object-cover">

                                <!-- Hot badge -->
                                <div class="absolute top-3 right-3 bg-red-500 text-white px-2 py-1 rounded-md text-xs font-semibold">
                                    Hot
                                </div>

                                <!-- Sport type badge -->
                                <div class="absolute bottom-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1.5 rounded-full text-sm font-medium text-gray-800">
                                    ${item.Courts[0].SportType}
                                </div>
                            </div>

                            <div class="p-4 ">
                                <h3 class="font-bold text-lg text-gray-900 mb-1">${item.Name}</h3>

                                <div class="flex items-center text-gray-500 text-sm mb-2">
                                    <i class="ri-map-pin-line text-gray-400 mr-1"></i>
                                    <span>${address}</span>
                                </div>

                                <div class="flex items-center text-sm mb-3">
                                    <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                    <span class="font-semibold text-gray-800">4.7</span>
                                    <span class="text-gray-500 ml-1">(124 đánh giá)</span>
                                </div>

                                <!-- Available time slots -->
                                <div class="mb-4">
                                    <div class="flex items-center text-sm text-gray-600 mb-2">
                                        <i class="ri-time-line mr-1"></i>
                                        <span>Khung giờ trống hôm nay:</span>
                                    </div>
                                    <div class="grid grid-cols-4 gap-1">
                                        <span class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-md font-medium">09:00</span>
                                        <span class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-md font-medium">11:00</span>
                                        <span class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-md font-medium">14:00</span>
                                        <span class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-md font-medium">17:00</span>
                                    </div>
                                </div>

                                <div class=" items-center justify-end">
                                    <div class="text-2xl font-bold text-blue-600">
                                        ${formattedPrice}<span class="text-sm font-normal text-gray-500">₫/giờ</span>
                                    </div>
                                    <button class="w-full mt-2 bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors"
                                    onclick="redirectToBooking('${item.Id}')">
                                        Đặt ngay
                                    </button>
                                </div>
                            </div>
                        </div>`;
                    });
                            if (skip === 0) {
            $('#stadium-grid').html(html).show();
        } else {
            $('#stadium-grid').append(html);
        }
                } else {
                    $('#stadium-grid').empty().hide();
                }
            },
            error: function () {
                $('#stadium-grid').empty().hide();
                console.log('Error fetching suggestions');
            }
        });
        }


    </script>
}


