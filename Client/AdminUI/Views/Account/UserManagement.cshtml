@{
    ViewData["Title"] = "Quản Lý Người Dùng";
}

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/css/account/user_management.css" rel="stylesheet" />
}

<div class="user-management-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">Quản Lý Người Dùng</h1>
        <div class="header-actions">
            <button id="exportExcelBtn" class="btn btn-outline">
                <i class="fas fa-file-excel me-2"></i>
                Xuất Excel
            </button>
            <button id="refreshDataBtn" class="btn btn-primary">
                <i class="fas fa-sync-alt me-2"></i>
                Làm mới
            </button>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
        <div class="stat-item border-blue"><div class="stat-label">Tổng người dùng</div><div class="stat-value" id="totalUsers">0</div></div>
        <div class="stat-item border-green"><div class="stat-label">Đang hoạt động</div><div class="stat-value" id="activeUsers">0</div></div>
        <div class="stat-item border-red"><div class="stat-label">Bị khóa</div><div class="stat-value" id="bannedUsers">0</div></div>
        <div class="stat-item border-yellow"><div class="stat-label">Mới tháng này</div><div class="stat-value" id="newUsersThisMonth">0</div></div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <form id="filterForm" class="filter-form">
            <div class="form-group">
                <label class="form-label">Tìm kiếm</label>
                <div class="search-input">
                    <i class="ri-search-line"></i>
                    <input type="text" class="form-input" id="searchInput" placeholder="Nhập email, tên hoặc SĐT...">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Tháng đăng ký</label>
                <input type="month" class="form-input" id="monthFilter">
            </div>
            <div class="form-group">
                <label class="form-label">Trạng thái</label>
                <select class="form-input" id="statusFilter">
                    <option value="">Tất cả</option>
                    <option value="active">Hoạt động</option>
                    <option value="banned">Bị khóa</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Vai trò</label>
                <select class="form-input" id="roleFilter">
                    <option value="">Tất cả</option>
                    <option value="Admin">Quản trị viên</option>
                    <option value="Customer">Khách hàng</option>
                    <option value="StadiumManager">Quản lý sân bãi</option>
                </select>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">
                    <i class="ri-filter-3-line"></i>
                    Lọc
                </button>
            </div>
        </form>
    </div>

    <!-- User Table -->
    <div class="table-container">
        <div class="table-header"><h3 class="table-title">Danh sách người dùng</h3></div>
        <div class="table-responsive">
            <table class="users-table">
                <thead><tr><th>Người dùng</th><th>Email / SĐT</th><th>Ngày đăng ký</th><th>Vai trò</th><th>Trạng thái</th><th>Thao tác</th></tr></thead>
                <tbody id="usersTableBody"></tbody>
            </table>
        </div>
        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="ri-user-search-line empty-icon"></i>
            <h3>Không tìm thấy người dùng</h3>
            <p>Vui lòng điều chỉnh lại bộ lọc của bạn.</p>
        </div>
        <div class="pagination-container">
            <div class="pagination-info">Hiển thị <span id="showingFrom">0</span> - <span id="showingTo">0</span> trong tổng số <span id="totalRecords">0</span></div>
            <div class="pagination" id="paginationContainer"></div>
        </div>
    </div>
</div>

<!-- SỬA LỖI: Chuyển sang Bootstrap Modal -->
<div class="modal fade" id="profileModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" id="profileModalContent">
            <!-- Content được load bằng JS -->
        </div>
    </div>
</div>

<div class="modal fade" id="banModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác nhận khóa người dùng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn khóa tài khoản <strong id="banUserName"></strong>?</p>
                <div class="mb-3">
                    <label for="banReason" class="form-label">Lý do khóa (tùy chọn)</label>
                    <textarea class="form-control" id="banReason" rows="3" placeholder="Nhập lý do..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmBanBtn">Xác nhận khóa</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="~/js/account/user_management.js"></script>
}